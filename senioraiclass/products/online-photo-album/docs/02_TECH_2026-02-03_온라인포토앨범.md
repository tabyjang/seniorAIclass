# 온라인 포토 앨범 기술 설계서

**작성일:** 2026-02-03  
**버전:** 1.0  
**작성자:** Claude AI

---

## 1. 아키텍처 개요

### 1.1 시스템 구조

```
┌─────────────────────────────────────────┐
│           사용자 (브라우저)              │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│        HTML/CSS/JavaScript              │
│  ┌──────────┬──────────┬──────────┐    │
│  │  UI Layer│  Logic   │  Storage │    │
│  │          │  Layer   │  Layer   │    │
│  └──────────┴──────────┴──────────┘    │
└─────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  localStorage / IndexedDB (브라우저)    │
└─────────────────────────────────────────┘
```

### 1.2 모듈 구조

```
online-photo-album/
├── index.html              # 메인 페이지
├── albums.html             # 앨범 목록 페이지
├── css/
│   ├── style.css           # 공통 스타일
│   ├── gallery.css         # 갤러리 스타일
│   └── album.css           # 앨범 카드 스타일
├── js/
│   ├── app.js              # 메인 앱 로직
│   ├── gallery.js          # 갤러리 기능
│   ├── album.js            # 앨범 관리
│   ├── storage.js          # 데이터 저장
│   └── lightbox.js         # 라이트박스
└── assets/
    └── (이미지 저장 폴더)
```

---

## 2. 기술 스택

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **언어** | HTML5 | - | 마크업 |
| **언어** | CSS3 | - | 스타일링 |
| **언어** | JavaScript | ES6+ | 기능 구현 |
| **스타일** | CSS Grid/Flexbox | - | 레이아웃 |
| **폰트** | Noto Sans KR | - | 한글 폰트 |
| **아이콘** | Emoji/Unicode | - | 아이콘 |
| **저장소** | localStorage | - | 메타데이터 저장 |
| **저장소** | IndexedDB | - | 이미지 저장 |
| **배포** | GitHub Pages | - | 물류 호스팅 |

---

## 3. 핵심 기술 구현

### 3.1 Masonry 레이아웃

**CSS Columns 방식 (권장):**
```css
.gallery {
  column-count: 4;
  column-gap: 20px;
}

.photo-card {
  break-inside: avoid;  /* 핵심: 카드가 잘리지 않음 */
  margin-bottom: 20px;
}

/* 반응형 */
@media (max-width: 1200px) { .gallery { column-count: 4; } }
@media (max-width: 900px) { .gallery { column-count: 3; } }
@media (max-width: 600px) { .gallery { column-count: 2; } }
```

**장점:**
- JavaScript 불필요 (성능 우수)
- 브라우저 네이티브 지원
- 간단한 구현

**단점:**
- 수평 순서가 아닌 수직 순서로 채워짐
- 시니어용에는 적합

### 3.2 이미지 업로드

**File API 사용:**
```javascript
// 파일 입력
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', handleFiles);

// 드래그앤드롭
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('drag-over');
});

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  const files = e.dataTransfer.files;
  handleFiles({ target: { files } });
});

// 파일 처리
function handleFiles(e) {
  const files = Array.from(e.target.files);
  files.forEach(file => {
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (event) => {
        saveImage(event.target.result, file.name);
      };
      reader.readAsDataURL(file);
    }
  });
}
```

### 3.3 데이터 저장

**localStorage (메타데이터):**
```javascript
// 앨범 데이터 구조
const albumData = {
  id: 'album_123',
  name: '손주 사진',
  description: '2024년 손주 성장 기록',
  date: '2024-02-03',
  coverImage: 'data:image/jpeg;base64,...',
  photoCount: 12
};

// 저장
localStorage.setItem('albums', JSON.stringify(albums));

// 불러오기
const albums = JSON.parse(localStorage.getItem('albums')) || [];
```

**IndexedDB (이미지):**
```javascript
// DB 연결
const dbPromise = idb.openDB('photoAlbum', 1, {
  upgrade(db) {
    db.createObjectStore('photos', { keyPath: 'id' });
    db.createObjectStore('albums', { keyPath: 'id' });
  }
});

// 이미지 저장
async function saveImage(imageData, albumId) {
  const db = await dbPromise;
  const id = 'photo_' + Date.now();
  await db.put('photos', {
    id,
    albumId,
    data: imageData,
    date: new Date().toISOString()
  });
  return id;
}

// 이미지 불러오기
async function getImage(id) {
  const db = await dbPromise;
  return await db.get('photos', id);
}
```

### 3.4 라이트박스

```javascript
class Lightbox {
  constructor() {
    this.currentIndex = 0;
    this.photos = [];
    this.element = document.getElementById('lightbox');
    this.bindEvents();
  }

  open(photos, startIndex = 0) {
    this.photos = photos;
    this.currentIndex = startIndex;
    this.render();
    this.element.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  close() {
    this.element.classList.remove('active');
    document.body.style.overflow = '';
  }

  next() {
    this.currentIndex = (this.currentIndex + 1) % this.photos.length;
    this.render();
  }

  prev() {
    this.currentIndex = (this.currentIndex - 1 + this.photos.length) % this.photos.length;
    this.render();
  }

  render() {
    const photo = this.photos[this.currentIndex];
    document.getElementById('lightbox-img').src = photo.data;
    document.getElementById('lightbox-counter').textContent = 
      `${this.currentIndex + 1} / ${this.photos.length}`;
  }

  bindEvents() {
    // 키보드 네비게이션
    document.addEventListener('keydown', (e) => {
      if (!this.element.classList.contains('active')) return;
      if (e.key === 'Escape') this.close();
      if (e.key === 'ArrowRight') this.next();
      if (e.key === 'ArrowLeft') this.prev();
    });

    // 클릭으로 닫기 (배경 클릭 시)
    this.element.addEventListener('click', (e) => {
      if (e.target === this.element) this.close();
    });
  }
}
```

---

## 4. 클래스 설계

### 4.1 AlbumManager (앨범 관리)

```javascript
class AlbumManager {
  constructor() {
    this.albums = this.loadAlbums();
  }

  // 앨범 생성
  createAlbum(name, description, date) {
    const album = {
      id: 'album_' + Date.now(),
      name,
      description,
      date,
      createdAt: new Date().toISOString(),
      photoIds: []
    };
    this.albums.push(album);
    this.saveAlbums();
    return album;
  }

  // 앨범 불러오기
  getAlbum(id) {
    return this.albums.find(a => a.id === id);
  }

  // 앨범 목록
  getAllAlbums() {
    return this.albums;
  }

  // 앨범 삭제
  deleteAlbum(id) {
    this.albums = this.albums.filter(a => a.id !== id);
    this.saveAlbums();
  }

  // 저장
  saveAlbums() {
    localStorage.setItem('albums', JSON.stringify(this.albums));
  }

  // 불러오기
  loadAlbums() {
    return JSON.parse(localStorage.getItem('albums')) || [];
  }
}
```

### 4.2 PhotoManager (사진 관리)

```javascript
class PhotoManager {
  constructor() {
    this.db = null;
    this.initDB();
  }

  async initDB() {
    this.db = await idb.openDB('photoAlbum', 1, {
      upgrade(db) {
        if (!db.objectStoreNames.contains('photos')) {
          db.createObjectStore('photos', { keyPath: 'id' });
        }
      }
    });
  }

  // 사진 저장
  async addPhoto(imageData, albumId, metadata = {}) {
    const photo = {
      id: 'photo_' + Date.now(),
      albumId,
      data: imageData,
      date: metadata.date || new Date().toISOString(),
      location: metadata.location || '',
      description: metadata.description || '',
      createdAt: new Date().toISOString()
    };
    
    await this.db.put('photos', photo);
    return photo;
  }

  // 앨범별 사진 불러오기
  async getPhotosByAlbum(albumId) {
    const allPhotos = await this.db.getAll('photos');
    return allPhotos.filter(p => p.albumId === albumId);
  }

  // 사진 삭제
  async deletePhoto(id) {
    await this.db.delete('photos', id);
  }
}
```

---

## 5. 데이터 구조

### 5.1 앨범 데이터

```typescript
interface Album {
  id: string;              // 고유 ID (album_timestamp)
  name: string;            // 앨범 이름
  description: string;     // 설명
  date: string;            // 날짜 (YYYY-MM-DD)
  createdAt: string;       // 생성일 (ISO 8601)
  photoIds: string[];      // 사진 ID 배열
  coverImage?: string;     // 커버 이미지 (base64)
}
```

### 5.2 사진 데이터

```typescript
interface Photo {
  id: string;              // 고유 ID (photo_timestamp)
  albumId: string;         // 소속 앨범 ID
  data: string;            // 이미지 데이터 (base64)
  date: string;            // 영일
  location: string;        // 장소
  description: string;     // 설명
  createdAt: string;       // 업로드일
  isFavorite: boolean;     // 즐겨찾기 여부
}
```

### 5.3 저장소 구조

```
localStorage:
├── albums: Album[]
└── settings: object

IndexedDB (photoAlbum):
├── objectStore: photos
│   └── Photo[]
└── objectStore: albums (백업용)
    └── Album[]
```

---

## 6. 에러 처리

### 6.1 예외 상황

| 상황 | 대응 |
|------|------|
| 저장소 꽉 참 | 오래된 사진 자동 삭제 또는 경고 |
| 이미지 로드 실패 | 기본 이미지 표시 |
| IndexedDB 미지원 | localStorage fallback |
| 파일 형식 오류 | JPG/PNG만 허용 메시지 |
| 파일 크기 초과 | 10MB 제한 메시지 |

### 6.2 에러 핸들러

```javascript
class ErrorHandler {
  static handle(error, context) {
    console.error(`[${context}]`, error);
    
    // 사용자 알림
    const message = this.getErrorMessage(error);
    this.showNotification(message, 'error');
  }

  static getErrorMessage(error) {
    if (error.name === 'QuotaExceededError') {
      return '저장 공간이 부족합니다. 사진을 정리해주세요.';
    }
    if (error.name === 'NotFoundError') {
      return '사진을 찾을 수 없습니다.';
    }
    return '오류가 발생했습니다. 다시 시도해주세요.';
  }

  static showNotification(message, type = 'info') {
    // 토스트 알림 표시
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.remove(), 3000);
  }
}
```

---

## 7. 테스트 계획

### 7.1 기능 테스트

| 기능 | 테스트 항목 | 예상 결과 |
|------|------------|----------|
| 업로드 | JPG 파일 선택 | 정상 업로드 |
| 업로드 | PNG 파일 선택 | 정상 업로드 |
| 업로드 | 10MB 이상 파일 | 오류 메시지 |
| 업로드 | TXT 파일 선택 | 오류 메시지 |
| 갤러리 | Masonry 레이아웃 | 사진 균일 배치 |
| 갤러리 | 반응형 (모바일) | 2열 표시 |
| 라이트박스 | 클릭 | 전체화면 표시 |
| 라이트박스 | ← → 키 | 사진 전환 |
| 라이트박스 | ESC | 닫기 |
| 저장 | 앨범 생성 | localStorage 저장 |
| 저장 | 사진 업로드 | IndexedDB 저장 |
| 저장 | 새로고침 | 데이터 유지 |

### 7.2 성능 테스트

| 항목 | 기준 | 측정 방법 |
|------|------|----------|
| 초기 로딩 | 3초 이내 | Chrome DevTools |
| 갤러리 렌더링 | 50장 기준 2초 | Performance API |
| 이미지 업로드 | 5MB 기준 5초 | 콘솔 시간 측정 |
| 메모리 사용 | 100MB 이하 | Chrome DevTools |

---

## 8. 보안 고려사항

### 8.1 XSS 방지
- 사용자 입력(설명, 장소)은 항상 escape 처리
- innerHTML 대신 textContent 사용

### 8.2 데이터 보안
- localStorage는 HTTPS에서만 권장
- 민감 정보는 저장하지 않음

### 8.3 파일 검증
- MIME 타입 체크
- 파일 크기 제한
- 확장자 체크

---

## 9. 성능 최적화

### 9.1 이미지 최적화
- 업로드 시 자동 리사이즈 (최대 1920px)
- 썸네일 자동 생성 (300px)
- Lazy loading 적용

### 9.2 렌더링 최적화
- will-change 속성 사용
- CSS 하드웨어 가속
- Intersection Observer로 lazy load

```javascript
// Lazy loading
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;
      observer.unobserve(img);
    }
  });
});

document.querySelectorAll('img[data-src]').forEach(img => {
  observer.observe(img);
});
```

---

## 10. 개발 환경

### 10.1 필요한 도구
- VS Code
- Chrome/Edge DevTools
- Live Server (VS Code 확장)

### 10.2 파일 구조

```
online-photo-album/
├── index.html
├── albums.html
├── css/
│   ├── base.css
│   ├── components.css
│   └── pages.css
├── js/
│   ├── main.js
│   ├── storage.js
│   ├── gallery.js
│   ├── album.js
│   └── lightbox.js
├── assets/
│   └── icons/
└── docs/
    ├── 01_PRD_...
    ├── 02_TECH_...
    ├── 03_ROADMAP_...
    └── 04_CHECKLIST_...
```

---

## 다음 단계

1. ✅ TECH 문서 완료
2. ⬜ ROADMAP 작성
3. ⬜ CHECKLIST 작성
4. ⬜ 실제 개발 시작

---

*최종 수정일: 2026-02-03*
