<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œë‹ˆì–´ íƒ€ì ì—°ìŠµ ğŸ¹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #FF8C42 0%, #87CEEB 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 800px;
            width: 100%;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px 25px;
            border-radius: 15px;
            text-align: center;
            min-width: 120px;
        }

        .stat-label {
            font-size: 1rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #FF8C42;
        }

        .sentence-display {
            background: #fff9f5;
            border: 3px solid #FF8C42;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            font-size: 2rem;
            line-height: 1.8;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .char {
            transition: all 0.1s;
        }

        .char.correct {
            color: #28a745;
        }

        .char.incorrect {
            color: #dc3545;
            text-decoration: underline;
        }

        .char.current {
            background: #FFE4B5;
            border-radius: 3px;
        }

        .char.composing {
            background: #E0E0E0;
            border-radius: 3px;
        }

        .input-area {
            margin-bottom: 20px;
        }

        #typingInput {
            width: 100%;
            padding: 20px;
            font-size: 1.8rem;
            border: 3px solid #ddd;
            border-radius: 15px;
            text-align: center;
            outline: none;
            transition: border-color 0.3s;
        }

        #typingInput:focus {
            border-color: #87CEEB;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 40px;
            font-size: 1.3rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: #FF8C42;
            color: white;
        }

        .btn-primary:hover {
            background: #e67832;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #87CEEB;
            color: white;
        }

        .btn-secondary:hover {
            background: #6bb8d9;
            transform: scale(1.05);
        }

        .level-selector {
            margin-bottom: 30px;
            text-align: center;
        }

        .level-selector label {
            font-size: 1.2rem;
            margin-right: 15px;
            color: #333;
        }

        .level-selector select {
            padding: 10px 20px;
            font-size: 1.2rem;
            border-radius: 10px;
            border: 2px solid #ddd;
            cursor: pointer;
        }

        .message {
            text-align: center;
            font-size: 1.5rem;
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .message.info {
            background: #fff3cd;
            color: #856404;
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF8C42, #FFB347);
            border-radius: 10px;
            transition: width 0.3s;
        }

        .hint {
            text-align: center;
            font-size: 1rem;
            color: #888;
            margin-top: 10px;
        }

        footer {
            margin-top: 30px;
            color: white;
            font-size: 1rem;
            opacity: 0.8;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .sentence-display {
                font-size: 1.4rem;
                padding: 20px;
            }
            
            #typingInput {
                font-size: 1.4rem;
            }
            
            .stat-value {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ¹ ì‹œë‹ˆì–´ íƒ€ì ì—°ìŠµ</h1>
    <p class="subtitle">ì²œì²œíˆ, ì •í™•í•˜ê²Œ, ì¦ê²ê²Œ!</p>

    <div class="container">
        <div class="level-selector">
            <label for="level">ë‚œì´ë„ ì„ íƒ:</label>
            <select id="level" onchange="changeLevel()">
                <option value="easy">ğŸŒ± ì‰¬ì›€ (ì§§ì€ ë¬¸ì¥)</option>
                <option value="medium">ğŸŒ¿ ë³´í†µ (ì¤‘ê°„ ë¬¸ì¥)</option>
                <option value="hard">ğŸŒ³ ì–´ë ¤ì›€ (ê¸´ ë¬¸ì¥)</option>
                <option value="proverb">ğŸ“š ì†ë‹´/ëª…ì–¸</option>
            </select>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">â±ï¸ ì‹œê°„</div>
                <div class="stat-value" id="timer">0ì´ˆ</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ğŸ“ ì§„í–‰</div>
                <div class="stat-value" id="progress">0/10</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ğŸ¯ ì •í™•ë„</div>
                <div class="stat-value" id="accuracy">100%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">âš¡ íƒ€ìˆ˜</div>
                <div class="stat-value" id="speed">0</div>
            </div>
        </div>

        <div class="sentence-display" id="sentenceDisplay">
            ì•„ë˜ 'ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”! ğŸ˜Š
        </div>

        <div class="input-area">
            <input type="text" id="typingInput" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”..." disabled>
            <p class="hint" id="hint"></p>
        </div>

        <div class="buttons">
            <button class="btn-primary" id="startBtn" onclick="startGame()">ğŸš€ ì‹œì‘!</button>
            <button class="btn-secondary" onclick="nextSentence()">â­ï¸ ë‹¤ìŒ ë¬¸ì¥</button>
        </div>

        <div class="message" id="message"></div>
    </div>

    <footer>
        ì‹œë‹ˆì–´ AI í´ë˜ìŠ¤ | ë§Œë“ ì´: ë²”ì‹ë‹˜ & ê³¨ë”” ğŸ¥‚
    </footer>

    <script>
        // ë‚œì´ë„ë³„ ë¬¸ì¥
        const sentences = {
            easy: [
                "ì•ˆë…•í•˜ì„¸ìš”",
                "ê°ì‚¬í•©ë‹ˆë‹¤",
                "ì‚¬ë‘í•©ë‹ˆë‹¤",
                "ì¢‹ì€ í•˜ë£¨",
                "í–‰ë³µí•˜ì„¸ìš”",
                "ë°˜ê°‘ìŠµë‹ˆë‹¤",
                "ê±´ê°•í•˜ì„¸ìš”",
                "ìˆ˜ê³ í•˜ì…¨ì–´ìš”",
                "ë§›ìˆê²Œ ë“œì„¸ìš”",
                "ì˜ ììš”"
            ],
            medium: [
                "ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì¢‹ìŠµë‹ˆë‹¤",
                "ë§›ìˆëŠ” ì ì‹¬ ë“œì„¸ìš”",
                "ê±´ê°•ì´ ìµœê³ ì…ë‹ˆë‹¤",
                "ê°€ì¡±ì´ ë³´ê³  ì‹¶ì–´ìš”",
                "ì‚°ì±…í•˜ê¸° ì¢‹ì€ ë‚ ì´ì—ìš”",
                "ì»¤í”¼ í•œ ì” í• ê¹Œìš”",
                "ì˜¤ëŠ˜ë„ í™”ì´íŒ…ì…ë‹ˆë‹¤",
                "ì¢‹ì€ ê¿ˆ ê¾¸ì„¸ìš”",
                "í–‰ë³µí•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”",
                "ë‚´ì¼ ë˜ ë§Œë‚˜ìš”"
            ],
            hard: [
                "ì‚°í† ë¼ í† ë¼ì•¼ ì–´ë””ë¥¼ ê°€ëŠëƒ",
                "ê¹Šì€ ì‚°ì† ì˜¹ë‹¬ìƒ˜ ëˆ„ê°€ ì™€ì„œ ë¨¹ë‚˜ìš”",
                "í‘¸ë¥¸ í•˜ëŠ˜ ì€í•˜ìˆ˜ í•˜ì–€ ìª½ë°°ì—",
                "ê³ í–¥ì˜ ë´„ ë‚˜ì˜ ì‚´ë˜ ê³ í–¥ì€",
                "ë™í•´ë¬¼ê³¼ ë°±ë‘ì‚°ì´ ë§ˆë¥´ê³  ë‹³ë„ë¡",
                "ê½ƒ í”¼ëŠ” ë´„ì´ ì˜¤ë©´ ì‚°ì— ë“¤ì—",
                "ì•„ì¹¨ ì´ìŠ¬ì„ ë§ìœ¼ë©° ì‚°ì±…ì„ í•©ë‹ˆë‹¤",
                "ì†ì£¼ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ì‹œê°„ì´ í–‰ë³µí•©ë‹ˆë‹¤",
                "ì˜¤ëŠ˜ ë°°ìš´ ê²ƒì„ ë‚´ì¼ ì—°ìŠµí•©ë‹ˆë‹¤",
                "ì²œì²œíˆ í•˜ë©´ ëˆ„êµ¬ë‚˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
            ],
            proverb: [
                "ë‚®ë§ì€ ìƒˆê°€ ë“£ê³  ë°¤ë§ì€ ì¥ê°€ ë“£ëŠ”ë‹¤",
                "ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬",
                "ì²œ ë¦¬ ê¸¸ë„ í•œ ê±¸ìŒë¶€í„°",
                "ì½© ì‹¬ì€ ë° ì½© ë‚˜ê³  íŒ¥ ì‹¬ì€ ë° íŒ¥ ë‚œë‹¤",
                "ê°€ëŠ” ë§ì´ ê³ ì™€ì•¼ ì˜¤ëŠ” ë§ì´ ê³±ë‹¤",
                "ê¿© ë¨¹ê³  ì•Œ ë¨¹ëŠ”ë‹¤",
                "ì„¸ ì‚´ ë²„ë¦‡ ì—¬ë“ ê¹Œì§€ ê°„ë‹¤",
                "í˜¸ë‘ì´ë„ ì œ ë§í•˜ë©´ ì˜¨ë‹¤",
                "í‹°ëŒ ëª¨ì•„ íƒœì‚°",
                "ì†Œ ìƒê³  ì™¸ì–‘ê°„ ê³ ì¹œë‹¤"
            ]
        };

        let currentLevel = 'easy';
        let currentSentences = [...sentences.easy];
        let currentSentence = '';
        let currentIndex = 0;
        let sentenceCount = 0;
        let totalSentences = 10;
        let startTime = null;
        let timerInterval = null;
        let totalChars = 0;
        let correctChars = 0;
        let isPlaying = false;
        let isComposing = false; // í•œê¸€ ì¡°í•© ì¤‘ì¸ì§€ ì²´í¬
        let isChecking = false; // ì¤‘ë³µ ì²´í¬ ë°©ì§€ í”Œë˜ê·¸
        let lastInput = ''; // ë§ˆì§€ë§‰ ì™„ì„±ëœ ì…ë ¥ê°’

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function changeLevel() {
            currentLevel = document.getElementById('level').value;
            currentSentences = shuffleArray(sentences[currentLevel]);
            currentIndex = 0;
            if (isPlaying) {
                loadSentence();
            }
        }

        function startGame() {
            isPlaying = true;
            sentenceCount = 0;
            totalChars = 0;
            correctChars = 0;
            currentSentences = shuffleArray(sentences[currentLevel]);
            currentIndex = 0;
            
            document.getElementById('typingInput').disabled = false;
            document.getElementById('typingInput').value = '';
            document.getElementById('typingInput').focus();
            document.getElementById('startBtn').textContent = 'ğŸ”„ ë‹¤ì‹œ ì‹œì‘';
            document.getElementById('message').className = 'message';
            document.getElementById('hint').textContent = 'ğŸ’¡ ë‹¤ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ë„˜ì–´ê°€ìš”!';
            
            startTime = new Date();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000);
            
            loadSentence();
            updateStats();
        }

        function loadSentence() {
            if (currentIndex >= currentSentences.length) {
                currentSentences = shuffleArray(sentences[currentLevel]);
                currentIndex = 0;
            }
            
            currentSentence = currentSentences[currentIndex];
            displaySentence();
            document.getElementById('typingInput').value = '';
            document.getElementById('typingInput').focus();
        }

        function displaySentence() {
            const display = document.getElementById('sentenceDisplay');
            const input = document.getElementById('typingInput').value;
            
            // í•œê¸€ ì •ê·œí™” (NFC ë°©ì‹ìœ¼ë¡œ í†µì¼)
            const normalizedInput = input.normalize('NFC');
            const normalizedSentence = currentSentence.normalize('NFC');
            
            // ì™„ì„±ëœ ê¸€ì ìˆ˜ ê³„ì‚° (ì¡°í•© ì¤‘ì´ë©´ ë§ˆì§€ë§‰ ê¸€ìëŠ” ì¡°í•© ì¤‘ì¸ ìƒíƒœ)
            const completedLength = isComposing && normalizedInput.length > 0 
                ? normalizedInput.length - 1 
                : normalizedInput.length;
            
            let html = '';
            for (let i = 0; i < normalizedSentence.length; i++) {
                let className = 'char';
                if (i < completedLength) {
                    // ì™„ì„±ëœ ê¸€ì ë¹„êµ (ì •ê·œí™”ëœ ê°’ìœ¼ë¡œ ë¹„êµ)
                    if (normalizedInput[i] === normalizedSentence[i]) {
                        className += ' correct';
                    } else {
                        className += ' incorrect';
                    }
                } else if (i === completedLength) {
                    // í˜„ì¬ ì…ë ¥ ìœ„ì¹˜
                    if (isComposing) {
                        className += ' composing';
                    } else {
                        className += ' current';
                    }
                }
                html += `<span class="${className}">${normalizedSentence[i]}</span>`;
            }
            display.innerHTML = html;
        }

        function updateTimer() {
            if (!startTime) return;
            const elapsed = Math.floor((new Date() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                minutes > 0 ? `${minutes}ë¶„ ${seconds}ì´ˆ` : `${seconds}ì´ˆ`;
        }

        function updateStats() {
            document.getElementById('progress').textContent = `${sentenceCount}/${totalSentences}`;
            document.getElementById('progressFill').style.width = `${(sentenceCount / totalSentences) * 100}%`;
            
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            
            if (startTime) {
                const elapsed = (new Date() - startTime) / 1000 / 60; // ë¶„
                const speed = elapsed > 0 ? Math.round(correctChars / elapsed) : 0;
                document.getElementById('speed').textContent = speed;
            }
        }

        function checkInput() {
            // ì¤‘ë³µ ì²´í¬ ë°©ì§€
            if (isChecking) return;
            
            // í•œê¸€ ì¡°í•© ì¤‘ì´ë©´ ì²´í¬í•˜ì§€ ì•Šê³  í™”ë©´ í‘œì‹œë§Œ ì—…ë°ì´íŠ¸
            if (isComposing) {
                displaySentence();
                return;
            }
            
            isChecking = true;
            
            try {
                const input = document.getElementById('typingInput').value;
                lastInput = input;
                
                // í•œê¸€ ì •ê·œí™” (NFC ë°©ì‹ìœ¼ë¡œ í†µì¼)
                const normalizedInput = input.normalize('NFC');
                const normalizedSentence = currentSentence.normalize('NFC');
                
                displaySentence();
                
                // ì •í™•íˆ ì¼ì¹˜í•˜ë©´ ì •ë‹µ!
                if (normalizedInput === normalizedSentence) {
                    sentenceCount++;
                    
                    // ì •í™•ë„ ê³„ì‚° - ê¸€ì ë‹¨ìœ„ë¡œ ì •í™•íˆ ê³„ì‚°
                    let correct = 0;
                    for (let i = 0; i < normalizedSentence.length; i++) {
                        if (normalizedInput[i] === normalizedSentence[i]) {
                            correct++;
                        }
                    }
                    
                    totalChars += normalizedSentence.length;
                    correctChars += correct;
                    
                    updateStats();
                    
                    if (sentenceCount >= totalSentences) {
                        endGame();
                    } else {
                        showMessage('ì˜í•˜ì…¨ì–´ìš”! ğŸ‘', 'success');
                        setTimeout(() => {
                            document.getElementById('message').className = 'message';
                            currentIndex++;
                            loadSentence();
                        }, 800);
                    }
                }
            } finally {
                isChecking = false;
            }
        }

        function nextSentence() {
            if (!isPlaying) return;
            
            const input = document.getElementById('typingInput').value;
            
            // í•œê¸€ ì •ê·œí™” (NFC ë°©ì‹ìœ¼ë¡œ í†µì¼)
            const normalizedInput = input.normalize('NFC');
            const normalizedSentence = currentSentence.normalize('NFC');
            
            // ì…ë ¥í•œ ê¸€ì ìˆ˜ë§Œí¼ í†µê³„ì— ë°˜ì˜
            if (normalizedInput.length > 0) {
                totalChars += normalizedInput.length;
                for (let i = 0; i < normalizedInput.length && i < normalizedSentence.length; i++) {
                    if (normalizedInput[i] === normalizedSentence[i]) {
                        correctChars++;
                    }
                }
            }
            
            currentIndex++;
            loadSentence();
            updateStats();
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
        }

        function endGame() {
            isPlaying = false;
            clearInterval(timerInterval);
            document.getElementById('typingInput').disabled = true;
            document.getElementById('hint').textContent = '';
            
            const elapsed = Math.floor((new Date() - startTime) / 1000);
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
            const speed = elapsed > 0 ? Math.round(correctChars / (elapsed / 60)) : 0;
            
            let grade = '';
            if (accuracy >= 95 && speed >= 100) grade = 'ğŸ† ìµœê³ ì˜ˆìš”!';
            else if (accuracy >= 90) grade = 'ğŸ¥‡ í›Œë¥­í•´ìš”!';
            else if (accuracy >= 80) grade = 'ğŸ¥ˆ ì˜í•˜ì…¨ì–´ìš”!';
            else grade = 'ğŸ¥‰ ì¢‹ì•„ìš”!';
            
            showMessage(
                `${grade}\nì™„ë£Œ! ì •í™•ë„ ${accuracy}%, ë¶„ë‹¹ ${speed}íƒ€`,
                'success'
            );
            
            document.getElementById('startBtn').textContent = 'ğŸš€ ë‹¤ì‹œ ì‹œì‘!';
        }

        // ì…ë ¥ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const typingInput = document.getElementById('typingInput');
        
        // í•œê¸€ ì¡°í•© ì‹œì‘
        typingInput.addEventListener('compositionstart', function() {
            isComposing = true;
        });
        
        // í•œê¸€ ì¡°í•© ë
        typingInput.addEventListener('compositionend', function(e) {
            isComposing = false;
            lastInput = e.target.value;
            // ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ input ì´ë²¤íŠ¸ì™€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡
            setTimeout(() => {
                checkInput();
            }, 0);
        });
        
        // ì¼ë°˜ ì…ë ¥ ì´ë²¤íŠ¸ (ì˜ì–´, ìˆ«ì ë“±)
        typingInput.addEventListener('input', function(e) {
            if (!isComposing) {
                lastInput = e.target.value;
                checkInput();
            } else {
                // ì¡°í•© ì¤‘ì—ëŠ” í™”ë©´ë§Œ ì—…ë°ì´íŠ¸
                displaySentence();
            }
        });
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ì—”í„°ë¡œ ë‹¤ìŒ)
        typingInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                nextSentence();
            }
        });
    </script>
</body>
</html>
