<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® ë² ë„¤ì¹˜ì•„ ê²Œì„ - ì‹œë‹ˆì–´ íƒ€ì ì—°ìŠµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #020617 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* í—¤ë” */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #D4A52C;
        }

        .header h1 {
            font-size: 2rem;
            color: #D4A52C;
        }

        .header-stats {
            display: flex;
            gap: 30px;
            font-size: 1.5rem;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-label {
            color: #87CEEB;
        }

        .stat-value {
            color: #D4A52C;
            font-weight: bold;
        }

        .lives {
            color: #FF4444;
            font-size: 1.8rem;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ê²Œì„ ë ˆì´ì•„ì›ƒ (ê²Œì„ + ì„¤ì • íŒ¨ë„) */
        .game-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .game-section {
            flex: 1;
        }

        /* ì„¤ì • íŒ¨ë„ */
        .settings-panel {
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #D4A52C;
            border-radius: 15px;
            padding: 20px;
        }

        .settings-panel h3 {
            color: #D4A52C;
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .setting-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            display: block;
            color: #87CEEB;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .setting-value {
            color: #D4A52C;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* ì†ë„ ìŠ¬ë¼ì´ë” */
        .speed-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #D4A52C;
            cursor: pointer;
        }

        .speed-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #D4A52C;
            cursor: pointer;
            border: none;
        }

        /* ìƒëª… ì¡°ì ˆ ë²„íŠ¼ */
        .lives-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .lives-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lives-btn.minus {
            background: #FF4444;
            color: white;
        }

        .lives-btn.plus {
            background: #28a745;
            color: white;
        }

        .lives-btn:hover {
            transform: scale(1.1);
        }

        .lives-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .lives-count {
            font-size: 1.5rem;
            color: #FF4444;
            font-weight: bold;
        }

        /* ê²Œì„ ì˜ì—­ */
        .game-area {
            position: relative;
            width: 100%;
            height: 500px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid #D4A52C;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        /* ë–¨ì–´ì§€ëŠ” ë‹¨ì–´ */
        .falling-word {
            position: absolute;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            will-change: top;
            transform: translateZ(0);
            transition: color 0.3s;
        }

        .falling-word.danger {
            color: #FF6B6B;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateZ(0) scale(1); }
            50% { transform: translateZ(0) scale(1.1); }
        }

        /* ë°”ë‹¥ì„  */
        .bottom-line {
            position: absolute;
            bottom: 50px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF4444, #FF6B6B);
            box-shadow: 0 0 10px #FF4444;
        }

        .bottom-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #FF4444;
            font-size: 0.9rem;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .input-area {
            margin: 20px 0;
            text-align: center;
        }

        #typingInput {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            font-size: 1.5rem;
            border: 3px solid #87CEEB;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            text-align: center;
            outline: none;
            transition: all 0.3s;
        }

        #typingInput:focus {
            border-color: #D4A52C;
            box-shadow: 0 0 20px rgba(212, 165, 44, 0.3);
        }

        #typingInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        #typingInput:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ë²„íŠ¼ */
        .buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        button {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-family: inherit;
        }

        .btn-start {
            background: #FF8C42;
            color: white;
        }

        .btn-start:hover {
            background: #e67832;
            transform: scale(1.05);
        }

        .btn-restart {
            background: #87CEEB;
            color: white;
            display: none;
        }

        .btn-restart:hover {
            background: #6bb8d9;
            transform: scale(1.05);
        }

        .btn-home {
            background: transparent;
            color: #87CEEB;
            border: 2px solid #87CEEB;
            padding: 10px 30px;
            font-size: 1rem;
        }

        .btn-home:hover {
            background: #87CEEB;
            color: #020617;
        }

        /* ê²Œì„ì˜¤ë²„ í™”ë©´ */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .game-over-content {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 20px;
            border: 3px solid #D4A52C;
        }

        .game-over h2 {
            font-size: 3rem;
            color: #FF4444;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 2rem;
            color: #D4A52C;
            margin-bottom: 30px;
        }

        /* íŒŒê´´ íš¨ê³¼ */
        .destroy-effect {
            position: absolute;
            font-size: 1.5rem;
            color: #28a745;
            font-weight: bold;
            pointer-events: none;
            animation: destroyPop 0.5s ease-out forwards;
        }

        @keyframes destroyPop {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.5) translateY(-30px);
                opacity: 0;
            }
        }

        /* íŒíŠ¸ */
        .hint {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
            font-size: 1rem;
        }

        /* ë‚œì´ë„ ì„ íƒ */
        .difficulty-selector {
            text-align: center;
            margin: 20px 0;
        }

        .difficulty-selector label {
            font-size: 1.2rem;
            margin-right: 15px;
            color: #87CEEB;
        }

        .difficulty-selector select {
            padding: 10px 20px;
            font-size: 1.2rem;
            border-radius: 10px;
            border: 2px solid #D4A52C;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
        }

        .difficulty-selector select option {
            background: #1e293b;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header-stats {
                font-size: 1.2rem;
                gap: 15px;
            }
            
            .game-area {
                height: 400px;
            }
            
            .falling-word {
                font-size: 1.5rem;
            }
            
            #typingInput {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <h1>ğŸ® ë² ë„¤ì¹˜ì•„ ê²Œì„</h1>
        <div class="header-stats">
            <div class="stat">
                <span class="stat-label">ì ìˆ˜:</span>
                <span class="stat-value" id="scoreDisplay">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">ìƒëª…:</span>
                <span class="lives" id="livesDisplay">â™¥â™¥â™¥</span>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- ë‚œì´ë„ ì„ íƒ -->
        <div class="difficulty-selector">
            <label for="difficulty">ë‚œì´ë„:</label>
            <select id="difficulty">
                <option value="easy">ğŸŒ± ì‰¬ì›€</option>
                <option value="medium" selected>ğŸŒ¿ ë³´í†µ</option>
                <option value="hard">ğŸŒ³ ì–´ë ¤ì›€</option>
            </select>
        </div>

        <!-- ê²Œì„ ë ˆì´ì•„ì›ƒ (ê²Œì„ + ì„¤ì • íŒ¨ë„) -->
        <div class="game-layout">
            <!-- ê²Œì„ ì„¹ì…˜ -->
            <div class="game-section">
                <!-- ê²Œì„ ì˜ì—­ -->
                <div class="game-area" id="gameArea">
                    <div class="bottom-line"></div>
                    <div class="bottom-label">âš ï¸ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ ìƒëª…ì´ ê°ì†Œí•©ë‹ˆë‹¤</div>
                </div>

                <!-- ì…ë ¥ ì˜ì—­ -->
                <div class="input-area">
                    <input 
                        type="text" 
                        id="typingInput" 
                        placeholder="ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..." 
                        disabled
                        autocomplete="off"
                    >
                    <p class="hint">ğŸ’¡ í™”ë©´ì˜ ë‹¨ì–´ì™€ ë˜‘ê°™ì´ ì…ë ¥í•˜ë©´ íŒŒê´´ë©ë‹ˆë‹¤!</p>
                </div>
            </div>

            <!-- ì„¤ì • íŒ¨ë„ -->
            <div class="settings-panel">
                <h3>âš™ï¸ ê²Œì„ ì„¤ì •</h3>
                
                <!-- ì†ë„ ì¡°ì ˆ -->
                <div class="setting-item">
                    <label class="setting-label">
                        ë‹¨ì–´ ì†ë„: <span class="setting-value" id="speedValue">ë³´í†µ</span>
                    </label>
                    <input 
                        type="range" 
                        class="speed-slider" 
                        id="speedSlider"
                        min="0.5" 
                        max="8" 
                        step="0.5" 
                        value="2.5"
                    >
                    <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: rgba(255,255,255,0.6);">
                        <span>ëŠë¦¼</span>
                        <span>ë¹ ë¦„</span>
                    </div>
                </div>

                <!-- ìƒëª… ì¡°ì ˆ -->
                <div class="setting-item">
                    <label class="setting-label">ì‹œì‘ ìƒëª…:</label>
                    <div class="lives-control">
                        <button class="lives-btn minus" id="livesMinus" onclick="adjustLives(-1)">âˆ’</button>
                        <span class="lives-count" id="settingsLives">3</span>
                        <button class="lives-btn plus" id="livesPlus" onclick="adjustLives(1)">+</button>
                    </div>
                    <p style="font-size: 0.8rem; color: rgba(255,255,255,0.5); margin-top: 8px;">
                        â™¥ ìµœëŒ€ 10ê°œ, ìµœì†Œ 1ê°œ
                    </p>
                </div>

                <!-- í˜„ì¬ ì„¤ì • í‘œì‹œ -->
                <div class="setting-item" style="background: rgba(212, 165, 44, 0.1); padding: 10px; border-radius: 8px;">
                    <label class="setting-label" style="margin-bottom: 5px;">í˜„ì¬ ì ìš©ê°’:</label>
                    <div style="font-size: 0.9rem; color: white;">
                        ì†ë„: <span id="currentSpeed">2.5</span> px/í”„ë ˆì„<br>
                        ìƒëª…: <span id="currentLives">3</span> ê°œ
                    </div>
                </div>
            </div>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="buttons">
            <button class="btn-start" id="startBtn" onclick="startGame()">ğŸš€ ê²Œì„ ì‹œì‘</button>
            <button class="btn-restart" id="restartBtn" onclick="resetGame()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
            <button class="btn-home" onclick="location.href='index.html'">â† ë©”ì¸ìœ¼ë¡œ</button>
        </div>
    </div>

    <!-- ê²Œì„ì˜¤ë²„ í™”ë©´ -->
    <div class="game-over" id="gameOverScreen">
        <div class="game-over-content">
            <h2>ê²Œì„ ì˜¤ë²„!</h2>
            <div class="final-score">
                ìµœì¢… ì ìˆ˜: <span id="finalScore">0</span>
            </div>
            <button class="btn-start" onclick="resetGame()" style="display: inline-block;">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        // ==========================================
        // Phase 1: ë°ì´í„° ì¤€ë¹„
        // ==========================================
        
        // ë‚œì´ë„ë³„ ë‹¨ì–´ ë°ì´í„°
        const wordData = {
            easy: [
                "ì•ˆë…•", "ê°ì‚¬", "ì‚¬ë‘", "í–‰ë³µ", "ì¢‹ì€",
                "ë°˜ê°€", "ê±´ê°•", "ìˆ˜ê³ ", "ì˜ì", "ë§›ìˆ",
                "í™˜ì˜", "ì¶•í•˜", "ëŒ€ë°•", "í™”ì´íŒ…", "ì‹ ë‚˜"
            ],
            medium: [
                "ì¢‹ì€í•˜ë£¨", "ê±´ê°•í•˜ì„¸ìš”", "ë§›ìˆê²Œë“œì„¸ìš”",
                "ë°˜ê°‘ìŠµë‹ˆë‹¤", "ìˆ˜ê³ í•˜ì…¨ì–´ìš”", "í–‰ë³µí•˜ì„¸ìš”",
                "ì•ˆë…•í•˜ì„¸ìš”", "ê°ì‚¬í•©ë‹ˆë‹¤", "ì‚¬ë‘í•©ë‹ˆë‹¤",
                "ì˜ììš”", "ì˜¤ëŠ˜ë„í˜ë‚´ìš”", "í•­ìƒì‘ì›í•´ìš”"
            ],
            hard: [
                "ì‚°í† ë¼í† ë¼ì•¼", "ë™í•´ë¬¼ê³¼ë°±ë‘ì‚°",
                "ì²œë¦¬ê¸¸ë„í•œê±¸ìŒ", "ê°€ëŠ”ë§ì´ê³ ì™€ì•¼",
                "ë‚®ë§ì€ìƒˆê°€ë“£ê³ ", "ê¿©ë¨¹ê³ ì•Œë¨¹ëŠ”ë‹¤",
                "ì„¸ì‚´ë²„ë¦‡ì—¬ë“ ê¹Œì§€", "í‹°ëŒëª¨ì•„íƒœì‚°",
                "í˜¸ë‘ì´ë„ì œë§í•˜ë©´", "ì†Œìƒê³ ì™¸ì–‘ê°„ê³ ì¹œë‹¤"
            ]
        };

        // ê²Œì„ ì„¤ì •
        const GAME_CONFIG = {
            GAME_AREA_HEIGHT: 500,
            GAME_AREA_WIDTH: 1000,
            BOTTOM_MARGIN: 50,
            SPAWN_INTERVAL_EASY: 2500,    // 2.5ì´ˆ
            SPAWN_INTERVAL_MEDIUM: 1800,  // 1.8ì´ˆ
            SPAWN_INTERVAL_HARD: 1200,    // 1.2ì´ˆ
            WORD_SPEED_EASY: 1.5,         // px/frame (60fps ê¸°ì¤€)
            WORD_SPEED_MEDIUM: 2.5,
            WORD_SPEED_HARD: 4.0,
            INITIAL_LIVES: 3,
            SCORE_PER_CHAR: 100
        };

        // ==========================================
        // Phase 3: í´ë˜ìŠ¤ ë° ìƒíƒœ ê´€ë¦¬
        // ==========================================
        
        // Word í´ë˜ìŠ¤
        class Word {
            constructor(text, x, speed) {
                this.text = text;
                this.x = x;
                this.y = 0;
                this.speed = speed;
                this.element = null;
                this.width = 0;
            }
            
            update() {
                this.y += this.speed;
            }
            
            createElement() {
                this.element = document.createElement('div');
                this.element.className = 'falling-word';
                this.element.textContent = this.text;
                this.element.style.left = `${this.x}px`;
                this.element.style.top = `${this.y}px`;
                
                // ë°”ë‹¥ ê·¼ì²˜ë©´ danger í´ë˜ìŠ¤ ì¶”ê°€
                const gameArea = document.getElementById('gameArea');
                const dangerZone = gameArea.clientHeight - GAME_CONFIG.BOTTOM_MARGIN - 100;
                
                if (this.y > dangerZone) {
                    this.element.classList.add('danger');
                }
                
                return this.element;
            }
            
            render() {
                if (this.element) {
                    this.element.style.top = `${this.y}px`;
                    
                    // ë°”ë‹¥ ê·¼ì²˜ ì²´í¬
                    const gameArea = document.getElementById('gameArea');
                    const dangerZone = gameArea.clientHeight - GAME_CONFIG.BOTTOM_MARGIN - 100;
                    
                    if (this.y > dangerZone && !this.element.classList.contains('danger')) {
                        this.element.classList.add('danger');
                    }
                }
            }
            
            destroy() {
                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }
            }
        }

        // ê²Œì„ ìƒíƒœ
        let gameState = {
            isPlaying: false,
            score: 0,
            lives: 3,
            words: [],
            lastSpawnTime: 0,
            animationId: null,
            difficulty: 'medium'
        };

        // DOM ìš”ì†Œ ì°¸ì¡°
        const elements = {
            gameArea: document.getElementById('gameArea'),
            scoreDisplay: document.getElementById('scoreDisplay'),
            livesDisplay: document.getElementById('livesDisplay'),
            typingInput: document.getElementById('typingInput'),
            startBtn: document.getElementById('startBtn'),
            restartBtn: document.getElementById('restartBtn'),
            gameOverScreen: document.getElementById('gameOverScreen'),
            finalScore: document.getElementById('finalScore'),
            difficulty: document.getElementById('difficulty'),
            speedSlider: document.getElementById('speedSlider'),
            speedValue: document.getElementById('speedValue'),
            settingsLives: document.getElementById('settingsLives'),
            currentSpeed: document.getElementById('currentSpeed'),
            currentLives: document.getElementById('currentLives'),
            livesMinus: document.getElementById('livesMinus'),
            livesPlus: document.getElementById('livesPlus')
        };

        // ì„¤ì •ê°’ (ì‚¬ìš©ìê°€ ì¡°ì ˆ ê°€ëŠ¥)
        let gameSettings = {
            wordSpeed: 2.5,  // ìŠ¬ë¼ì´ë” ê°’ (px/frame)
            initialLives: 3  // ì‹œì‘ ìƒëª…
        };

        // ==========================================
        // ì„¤ì • íŒ¨ë„ ê¸°ëŠ¥
        // ==========================================

        // ì†ë„ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
        elements.speedSlider.addEventListener('input', function() {
            const speed = parseFloat(this.value);
            gameSettings.wordSpeed = speed;
            
            // ì†ë„ í‘œì‹œ ì—…ë°ì´íŠ¸
            let speedText;
            if (speed <= 1.5) speedText = 'ë§¤ìš° ëŠë¦¼';
            else if (speed <= 2.5) speedText = 'ëŠë¦¼';
            else if (speed <= 3.5) speedText = 'ë³´í†µ';
            else if (speed <= 5) speedText = 'ë¹ ë¦„';
            else speedText = 'ë§¤ìš° ë¹ ë¦„';
            
            elements.speedValue.textContent = speedText;
            elements.currentSpeed.textContent = speed;
            
            // ê²Œì„ ì¤‘ì´ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì ìš© (ê¸°ì¡´ ë‹¨ì–´ëŠ” ì œì™¸, ìƒˆ ë‹¨ì–´ë¶€í„°)
            if (gameState.isPlaying) {
                // ìƒˆë¡œ ìƒì„±ë˜ëŠ” ë‹¨ì–´ì—ë§Œ ì ìš©ë¨
            }
        });

        // ìƒëª… ì¡°ì ˆ í•¨ìˆ˜
        function adjustLives(delta) {
            const newLives = gameSettings.initialLives + delta;
            
            // ìµœì†Œ 1, ìµœëŒ€ 10 ì œí•œ
            if (newLives >= 1 && newLives <= 10) {
                gameSettings.initialLives = newLives;
                elements.settingsLives.textContent = newLives;
                elements.currentLives.textContent = newLives;
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                elements.livesMinus.disabled = (newLives <= 1);
                elements.livesPlus.disabled = (newLives >= 10);
                
                // ê²Œì„ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ í˜„ì¬ ìƒëª…ë„ ì—…ë°ì´íŠ¸
                if (!gameState.isPlaying) {
                    gameState.lives = newLives;
                    updateLivesDisplay();
                }
            }
        }

        // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
        elements.livesMinus.disabled = (gameSettings.initialLives <= 1);
        elements.livesPlus.disabled = (gameSettings.initialLives >= 10);

        // ==========================================
        // Phase 3: ê²Œì„ ì—”ì§„ êµ¬í˜„
        // ==========================================
        
        // ë‹¨ì–´ ìƒì„±
        function spawnWord() {
            const words = wordData[gameState.difficulty];
            const randomText = words[Math.floor(Math.random() * words.length)];
            
            // ê²Œì„ ì˜ì—­ ë„ˆë¹„ ê°€ì ¸ì˜¤ê¸°
            const gameWidth = elements.gameArea.clientWidth;
            const maxX = gameWidth - 150; // ë‹¨ì–´ ë„ˆë¹„ ê³ ë ¤
            const randomX = Math.random() * maxX;
            
            // ì‚¬ìš©ìê°€ ì„¤ì •í•œ ì†ë„ ì‚¬ìš© (ìŠ¬ë¼ì´ë” ê°’)
            const speed = gameSettings.wordSpeed;
            
            const word = new Word(randomText, randomX, speed);
            const wordElement = word.createElement();
            elements.gameArea.appendChild(wordElement);
            
            // ë„ˆë¹„ ê³„ì‚° (ì¤‘ë³µ ë°©ì§€ìš©)
            word.width = wordElement.offsetWidth;
            
            gameState.words.push(word);
        }

        // ëª¨ë“  ë‹¨ì–´ ì—…ë°ì´íŠ¸
        function updateWords() {
            gameState.words.forEach(word => {
                word.update();
                word.render();
            });
        }

        // ë°”ë‹¥ ì¶©ëŒ ì²´í¬
        function checkBottomCollision() {
            const gameAreaHeight = elements.gameArea.clientHeight;
            const bottomY = gameAreaHeight - GAME_CONFIG.BOTTOM_MARGIN;
            
            for (let i = gameState.words.length - 1; i >= 0; i--) {
                const word = gameState.words[i];
                
                if (word.y >= bottomY) {
                    // ë‹¨ì–´ ì œê±°
                    word.destroy();
                    gameState.words.splice(i, 1);
                    
                    // ìƒëª… ê°ì†Œ
                    loseLife();
                }
            }
        }

        // ìƒëª… ê°ì†Œ
        function loseLife() {
            gameState.lives--;
            updateLivesDisplay();
            
            // í™”ë©´ í”ë“¤ë¦¼ íš¨ê³¼
            elements.gameArea.style.animation = 'shake 0.5s';
            setTimeout(() => {
                elements.gameArea.style.animation = '';
            }, 500);
            
            if (gameState.lives <= 0) {
                gameOver();
            }
        }

        // ìƒëª… UI ì—…ë°ì´íŠ¸
        function updateLivesDisplay() {
            const maxLives = Math.max(gameSettings.initialLives, gameState.lives);
            const hearts = 'â™¥'.repeat(gameState.lives) + 'â™¡'.repeat(maxLives - gameState.lives);
            elements.livesDisplay.textContent = hearts;
        }

        // ==========================================
        // Phase 4: ì…ë ¥ ë° íŒŒê´´ (í•œê¸€ ì…ë ¥ ë¬¸ì œ í•´ê²°)
        // ==========================================
        
        // ì…ë ¥ ì²˜ë¦¬ - Enter í‚¤ + ì •ê·œí™” ë°©ì‹
        function handleInput(event) {
            // Enter í‚¤ë§Œ ì²˜ë¦¬
            if (event.key !== 'Enter') return;
            
            if (!gameState.isPlaying) return;
            
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° ë° ì •ê·œí™” (í•œê¸€ ì…ë ¥ ë¬¸ì œ í•´ê²°!)
            let input = elements.typingInput.value.trim();
            
            // ğŸ”‘ í•µì‹¬: í•œê¸€ ì •ê·œí™” (NFC ë°©ì‹ìœ¼ë¡œ í†µì¼)
            input = input.normalize('NFC');
            
            if (!input) return;
            
            // í™”ë©´ì— ìˆëŠ” ë‹¨ì–´ ì¤‘ ì¼ì¹˜í•˜ëŠ” ê²ƒ ì°¾ê¸°
            // ì •ê·œí™”ëœ ê°’ìœ¼ë¡œ ë¹„êµ
            const matchIndex = gameState.words.findIndex(
                word => word.text.normalize('NFC') === input
            );
            
            if (matchIndex !== -1) {
                // ë‹¨ì–´ íŒŒê´´
                const word = gameState.words[matchIndex];
                
                // íŒŒê´´ íš¨ê³¼
                showDestroyEffect(word.x, word.y);
                
                // ë‹¨ì–´ ì œê±°
                word.destroy();
                gameState.words.splice(matchIndex, 1);
                
                // ì ìˆ˜ ì¶”ê°€
                const points = input.length * GAME_CONFIG.SCORE_PER_CHAR;
                addScore(points);
                
                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                elements.typingInput.value = '';
            }
        }

        // íŒŒê´´ íš¨ê³¼ í‘œì‹œ
        function showDestroyEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'destroy-effect';
            effect.textContent = 'íŒŒê´´! ğŸ’¥';
            effect.style.left = `${x}px`;
            effect.style.top = `${y}px`;
            elements.gameArea.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 500);
        }

        // ì ìˆ˜ ì¶”ê°€
        function addScore(points) {
            gameState.score += points;
            elements.scoreDisplay.textContent = gameState.score.toLocaleString();
        }

        // ==========================================
        // Phase 5: ê²Œì„ ìƒíƒœ ê´€ë¦¬
        // ==========================================
        
        // ê²Œì„ ë£¨í”„
        function gameLoop(timestamp) {
            if (!gameState.isPlaying) return;
            
            // 1. ëª¨ë“  ë‹¨ì–´ ì—…ë°ì´íŠ¸
            updateWords();
            
            // 2. ë°”ë‹¥ ì¶©ëŒ ì²´í¬
            checkBottomCollision();
            
            // 3. ìƒˆ ë‹¨ì–´ ìƒì„±
            let spawnInterval;
            switch(gameState.difficulty) {
                case 'easy': spawnInterval = GAME_CONFIG.SPAWN_INTERVAL_EASY; break;
                case 'hard': spawnInterval = GAME_CONFIG.SPAWN_INTERVAL_HARD; break;
                default: spawnInterval = GAME_CONFIG.SPAWN_INTERVAL_MEDIUM;
            }
            
            if (timestamp - gameState.lastSpawnTime > spawnInterval) {
                spawnWord();
                gameState.lastSpawnTime = timestamp;
            }
            
            // 4. ë‹¤ìŒ í”„ë ˆì„ ìš”ì²­
            gameState.animationId = requestAnimationFrame(gameLoop);
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (gameState.isPlaying) return;
            
            // ì´ˆê¸°í™”
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.lives = gameSettings.initialLives;
            gameState.words = [];
            gameState.lastSpawnTime = 0;
            gameState.difficulty = elements.difficulty.value;
            
            // UI ì—…ë°ì´íŠ¸
            elements.scoreDisplay.textContent = '0';
            updateLivesDisplay();
            elements.typingInput.disabled = false;
            elements.typingInput.value = '';
            elements.typingInput.focus();
            elements.startBtn.style.display = 'none';
            elements.restartBtn.style.display = 'none';
            elements.difficulty.disabled = true;
            
            // ê²Œì„ì˜¤ë²„ í™”ë©´ ìˆ¨ê¸°ê¸°
            elements.gameOverScreen.style.display = 'none';
            
            // ê²Œì„ ë£¨í”„ ì‹œì‘
            gameState.animationId = requestAnimationFrame(gameLoop);
        }

        // ê²Œì„ì˜¤ë²„
        function gameOver() {
            gameState.isPlaying = false;
            
            if (gameState.animationId) {
                cancelAnimationFrame(gameState.animationId);
            }
            
            // ì…ë ¥ì°½ ë¹„í™œì„±í™”
            elements.typingInput.disabled = true;
            
            // ëª¨ë“  ë‹¨ì–´ ì œê±°
            gameState.words.forEach(word => word.destroy());
            gameState.words = [];
            
            // ê²Œì„ì˜¤ë²„ í™”ë©´ í‘œì‹œ
            elements.finalScore.textContent = gameState.score.toLocaleString();
            elements.gameOverScreen.style.display = 'flex';
            elements.restartBtn.style.display = 'inline-block';
            elements.difficulty.disabled = false;
        }

        // ê²Œì„ ì¬ì‹œì‘
        function resetGame() {
            // ëª¨ë“  ë‹¨ì–´ ì œê±°
            gameState.words.forEach(word => word.destroy());
            gameState.words = [];
            
            // ê²Œì„ì˜¤ë²„ í™˜ë©´ ìˆ¨ê¸°ê¸°
            elements.gameOverScreen.style.display = 'none';
            
            // ê²Œì„ ì‹œì‘
            startGame();
        }

        // ==========================================
        // Phase 6: ì´ë²¤íŠ¸ ì—°ê²°
        // ==========================================
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ì…ë ¥ ì´ë²¤íŠ¸ (Enter í‚¤)
            elements.typingInput.addEventListener('keydown', handleInput);
            
            // ê²Œì„ ì˜ì—­ í´ë¦­ ì‹œ ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            elements.gameArea.addEventListener('click', () => {
                if (gameState.isPlaying) {
                    elements.typingInput.focus();
                }
            });
        }

        // ì´ˆê¸° ì„¤ì •ê°’ UI ì—…ë°ì´íŠ¸
        elements.currentSpeed.textContent = gameSettings.wordSpeed;
        elements.currentLives.textContent = gameSettings.initialLives;

        // ì´ˆê¸°í™”
        setupEventListeners();

        // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px); }
                75% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
