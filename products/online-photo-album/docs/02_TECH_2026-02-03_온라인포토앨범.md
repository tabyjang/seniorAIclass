# 온라인 포토 앨범 기술 설계서

**작성일:** 2026-02-03
**수정일:** 2026-02-04
**버전:** 2.0 (Supabase 적용)

---

## 1. 아키텍처 개요

### 1.1 시스템 구조

```
┌─────────────────────────────────────────┐
│           사용자 (브라우저)              │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│        HTML/CSS/JavaScript              │
│  ┌──────────┬──────────┬──────────┐    │
│  │  UI Layer│  Logic   │  API     │    │
│  │          │  Layer   │  Layer   │    │
│  └──────────┴──────────┴──────────┘    │
└──────────────┬──────────────────────────┘
               │ HTTPS
               ▼
┌─────────────────────────────────────────┐
│           Supabase                      │
│  ┌──────────┬──────────┬──────────┐    │
│  │PostgreSQL│ Storage  │   Auth   │    │
│  │  (DB)    │ (파일)   │ (미사용) │    │
│  └──────────┴──────────┴──────────┘    │
└─────────────────────────────────────────┘
```

### 1.2 폴더 구조

```
online-photo-album/
├── src/
│   ├── albums.html          # 앨범 목록 (메인)
│   ├── index.html           # 갤러리 (사진 보기/업로드)
│   ├── css/
│   │   ├── base.css         # 기본 스타일
│   │   ├── components.css   # 공통 컴포넌트
│   │   ├── albums.css       # 앨범 목록 스타일
│   │   └── gallery.css      # 갤러리 스타일
│   └── js/
│       ├── config.js        # ⚠️ Supabase 설정 (gitignore)
│       └── config.example.js # 설정 템플릿
├── docs/                    # 문서
├── .gitignore               # config.js 제외
└── .env.example             # 환경변수 예시
```

---

## 2. 기술 스택

| 구분 | 기술 | 용도 |
|------|------|------|
| **프론트엔드** | HTML5/CSS3/JS(ES6+) | UI 구현 |
| **백엔드** | Supabase | DB + Storage + API |
| **DB** | PostgreSQL (Supabase) | 앨범/사진 메타데이터 |
| **파일 저장** | Supabase Storage | 사진 파일 저장 |
| **인증** | 하드코딩 (localStorage) | 간단 로그인 |
| **배포** | GitHub Pages / Vercel | 정적 호스팅 |

---

## 3. Supabase 설정

### 3.1 프로젝트 정보

```
프로젝트명: online-photo-album
프로젝트 ID: zrpmnolsxswlgsxwxgnt
리전: ap-northeast-2 (서울)
```

### 3.2 config.js 구조

```javascript
// src/js/config.js (실제 키 - gitignore에 포함)
const CONFIG = {
  SUPABASE_URL: 'https://zrpmnolsxswlgsxwxgnt.supabase.co',
  SUPABASE_ANON_KEY: 'your-anon-key-here',
  STORAGE_BUCKET: 'photos',
  MAX_FILE_SIZE: 10 * 1024 * 1024  // 10MB
};
```

### 3.3 Supabase 클라이언트 초기화

```javascript
// CDN으로 Supabase 로드
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

// 클라이언트 생성
const supabase = window.supabase.createClient(
  CONFIG.SUPABASE_URL,
  CONFIG.SUPABASE_ANON_KEY
);
```

---

## 4. 데이터베이스 설계

### 4.1 albums 테이블

```sql
CREATE TABLE albums (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT DEFAULT '',
  date DATE,
  cover_image_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | 고유 ID |
| name | TEXT | 앨범 이름 |
| description | TEXT | 설명 |
| date | DATE | 날짜 |
| cover_image_url | TEXT | 커버 사진 URL |
| created_at | TIMESTAMP | 생성일 |

### 4.2 photos 테이블

```sql
CREATE TABLE photos (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  album_id UUID REFERENCES albums(id) ON DELETE CASCADE,
  file_name TEXT NOT NULL,
  file_url TEXT NOT NULL,
  file_size INTEGER,
  width INTEGER,
  height INTEGER,
  description TEXT DEFAULT '',
  location TEXT DEFAULT '',
  taken_at DATE,
  is_favorite BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | UUID | 고유 ID |
| album_id | UUID | 소속 앨범 (FK) |
| file_name | TEXT | 원본 파일명 |
| file_url | TEXT | Storage 공개 URL |
| file_size | INTEGER | 파일 크기 (bytes) |
| is_favorite | BOOLEAN | 즐겨찾기 |
| created_at | TIMESTAMP | 업로드일 |

### 4.3 Storage 버킷

```
버킷명: photos
공개여부: Public
파일 크기 제한: 10MB
허용 타입: image/jpeg, image/png, image/gif, image/webp
```

### 4.4 RLS 정책 (공개 접근)

```sql
-- 모든 사용자 읽기/쓰기 허용 (간단 로그인용)
CREATE POLICY "public_read" ON albums FOR SELECT USING (true);
CREATE POLICY "public_insert" ON albums FOR INSERT WITH CHECK (true);
CREATE POLICY "public_update" ON albums FOR UPDATE USING (true);
CREATE POLICY "public_delete" ON albums FOR DELETE USING (true);

-- photos 테이블도 동일하게 설정
```

---

## 5. 핵심 기능 구현

### 5.1 간단 로그인 (하드코딩)

```javascript
// 유효한 사용자 (하드코딩)
const VALID_USERS = {
  'test': '1234',
  'admin': 'admin'
};

// 로그인 처리
function handleLogin(id, password) {
  if (VALID_USERS[id] === password) {
    localStorage.setItem('photoAlbum_loggedIn', 'true');
    localStorage.setItem('photoAlbum_user', id);
    return true;
  }
  return false;
}

// 로그인 상태 확인
function isLoggedIn() {
  return localStorage.getItem('photoAlbum_loggedIn') === 'true';
}

// 로그아웃
function logout() {
  localStorage.removeItem('photoAlbum_loggedIn');
  localStorage.removeItem('photoAlbum_user');
}
```

### 5.2 앨범 CRUD

```javascript
// 앨범 목록 조회
async function getAlbums() {
  const { data, error } = await supabase
    .from('albums')
    .select('*')
    .order('created_at', { ascending: false });
  return data;
}

// 앨범 생성
async function createAlbum(name, description, date) {
  const { data, error } = await supabase
    .from('albums')
    .insert({ name, description, date })
    .select()
    .single();
  return data;
}

// 앨범 삭제
async function deleteAlbum(id) {
  await supabase.from('albums').delete().eq('id', id);
}
```

### 5.3 사진 업로드

```javascript
async function uploadPhoto(file, albumId) {
  // 1. 파일명 생성
  const ext = file.name.split('.').pop();
  const filePath = `uploads/${albumId}/${Date.now()}.${ext}`;

  // 2. Storage에 업로드
  const { error: uploadError } = await supabase.storage
    .from('photos')
    .upload(filePath, file);

  if (uploadError) throw uploadError;

  // 3. 공개 URL 가져오기
  const { data: { publicUrl } } = supabase.storage
    .from('photos')
    .getPublicUrl(filePath);

  // 4. DB에 메타데이터 저장
  const { data, error } = await supabase
    .from('photos')
    .insert({
      album_id: albumId,
      file_name: file.name,
      file_url: publicUrl,
      file_size: file.size
    });

  return data;
}
```

### 5.4 드래그앤드롭

```javascript
function setupDragAndDrop() {
  const dropZone = document.getElementById('dropZone');
  const fileInput = document.getElementById('fileInput');

  // 클릭으로 파일 선택
  dropZone.onclick = () => fileInput.click();

  // 파일 선택 시
  fileInput.onchange = (e) => {
    handleFiles(e.target.files);
  };

  // 드래그 오버
  dropZone.ondragover = (e) => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
  };

  // 드래그 떠남
  dropZone.ondragleave = () => {
    dropZone.classList.remove('drag-over');
  };

  // 드롭
  dropZone.ondrop = (e) => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    handleFiles(e.dataTransfer.files);
  };
}

async function handleFiles(files) {
  for (const file of files) {
    if (file.type.startsWith('image/')) {
      await uploadPhoto(file, currentAlbumId);
    }
  }
  loadPhotos(); // 갤러리 새로고침
}
```

---

## 6. 페이지 흐름

```
[albums.html]                    [index.html]
┌─────────────┐                 ┌─────────────┐
│  로그인?    │──No──> 로그인 모달
│     │      │
│    Yes     │
│     ▼      │
│  앨범 목록  │
│     │      │
│  앨범 클릭  │──────────────────>│  갤러리     │
│            │                   │     │       │
└─────────────┘                  │  사진 보기  │
                                 │  사진 추가  │
                                 │  슬라이드쇼 │
                                 └─────────────┘
```

---

## 7. 실행 방법

### 7.1 필수 조건
- VS Code + Live Server 확장
- Supabase 프로젝트 (이미 설정됨)

### 7.2 실행 순서

1. **config.js 확인**
   ```
   src/js/config.js 파일에 Supabase 키가 있는지 확인
   ```

2. **Live Server로 실행**
   ```
   VS Code에서 albums.html 열기
   우클릭 → "Open with Live Server"
   ```

3. **로그인**
   ```
   아이디: test
   비밀번호: 1234
   ```

4. **앨범 생성 → 사진 업로드**

---

## 8. 주의사항

### 8.1 보안
- `config.js`는 반드시 `.gitignore`에 포함
- 공개 키(anon key)는 클라이언트에서 사용 가능하지만, 민감한 작업은 RLS로 제어

### 8.2 제한사항
- 파일 직접 열기 (file://) 불가 → Live Server 필수
- 파일 크기: 10MB 이하
- 지원 형식: JPG, PNG, GIF, WebP

---

*최종 수정일: 2026-02-04*
