# AI 할머니의 옛날이야기 기술 설계서

**작성일**: 2026-02-03  
**작성자**: 골디  
**버전**: v1.0

---

## 1. 아키텍처 개요

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   대본 DB    │ ──▶ │   TTS 엔진   │ ──▶ │  오디오 파일  │
│  (텍스트)    │     │ (Qwen3-TTS) │     │   (.wav)    │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                                              ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 이미지 생성  │ ──▶ │  영상 합성   │ ◀── │   BGM/효과   │
│  (ComfyUI)  │     │  (FFmpeg)   │     │   (.mp3)    │
└─────────────┘     └─────────────┘     └─────────────┘
                          │
                          ▼
                    ┌─────────────┐
                    │   YouTube   │
                    │   업로드     │
                    └─────────────┘
```

---

## 2. 기술 스택

| 분류 | 기술 | 용도 |
|------|------|------|
| TTS | Qwen3-TTS | 음성 생성 |
| 이미지 | ComfyUI + FLUX | 썸네일/장면 이미지 |
| 영상 편집 | FFmpeg | 오디오+이미지 합성 |
| 자막 | Whisper (검증용) | 자막 생성 |
| 언어 | Python 3.14 | 자동화 스크립트 |
| 데이터 | JSON/Markdown | 대본 저장 |

---

## 3. 핵심 기술 상세

### 3.1 TTS 파이프라인

```python
from qwen_tts import Qwen3TTSModel

# 모델 초기화
tts = Qwen3TTSModel.from_pretrained(
    "Qwen/Qwen3-TTS",
    dtype=torch.float16,
    device_map="cuda:0"
)

# 음성 생성
audio = tts.synthesize(
    text="옛날 옛적에 호랑이가 담배 피던 시절에...",
    speaker="Sohee",
    language="Korean",
    emotion="warm"  # 따뜻한 톤
)

# 저장
audio.save("output/story_001.wav")
```

### 3.2 이미지 생성 (ComfyUI)

```json
{
  "prompt": "Korean grandmother telling story to children, warm illustration, soft colors, traditional Korean setting",
  "negative_prompt": "realistic, photo, dark",
  "width": 1280,
  "height": 720,
  "steps": 20
}
```

### 3.3 영상 합성 (FFmpeg)

```bash
# 이미지 + 오디오 → 영상
ffmpeg -loop 1 -i image.png -i audio.wav \
    -c:v libx264 -tune stillimage \
    -c:a aac -b:a 192k \
    -pix_fmt yuv420p -shortest \
    output.mp4

# 자막 추가
ffmpeg -i input.mp4 \
    -vf "subtitles=story.srt:force_style='FontName=KOTRA_BOLD,FontSize=48'" \
    output_with_sub.mp4
```

---

## 4. 모듈 구조

```
ai-grandma-story/
├── main.py                 # 메인 실행 스크립트
├── config.yaml             # 설정 파일
├── modules/
│   ├── tts_generator.py    # TTS 생성 모듈
│   ├── image_generator.py  # 이미지 생성 모듈
│   ├── video_composer.py   # 영상 합성 모듈
│   └── youtube_uploader.py # 유튜브 업로드 모듈
├── data/
│   ├── scripts/            # 대본 파일 (.md)
│   └── metadata/           # 에피소드 메타데이터
├── output/
│   ├── audio/              # 생성된 오디오
│   ├── images/             # 생성된 이미지
│   └── videos/             # 최종 영상
└── assets/
    ├── bgm/                # 배경음악
    ├── sfx/                # 효과음
    └── fonts/              # 자막 폰트
```

---

## 5. 데이터 구조

### 5.1 대본 형식 (Markdown)
```markdown
---
title: 흥부와 놀부
episode: 001
duration: 5min
emotion: warm
bgm: piano_gentle.mp3
---

# 흥부와 놀부

옛날 옛적에, 한 마을에 흥부와 놀부라는 형제가 살았어요.

[pause:1s]

형 놀부는 욕심이 많았고, 동생 흥부는 마음이 착했답니다.

...
```

### 5.2 메타데이터 (JSON)
```json
{
  "episode_id": "001",
  "title": "흥부와 놀부",
  "series": "전래동화",
  "duration_seconds": 300,
  "speaker": "Sohee",
  "emotion": "warm",
  "bgm": "piano_gentle.mp3",
  "thumbnail": "episode_001_thumb.png",
  "youtube_id": null,
  "created_at": "2026-02-03",
  "status": "draft"
}
```

---

## 6. API 연동

### 6.1 YouTube Data API
```python
from googleapiclient.discovery import build

youtube = build('youtube', 'v3', credentials=creds)

# 영상 업로드
request = youtube.videos().insert(
    part="snippet,status",
    body={
        "snippet": {
            "title": "흥부와 놀부 | AI 할머니의 옛날이야기",
            "description": "따뜻한 AI 할머니가 들려주는 전래동화",
            "tags": ["전래동화", "동화", "시니어", "할머니"],
            "categoryId": "22"
        },
        "status": {
            "privacyStatus": "public"
        }
    },
    media_body=MediaFileUpload("output.mp4")
)
```

---

## 7. 에러 처리

| 에러 | 원인 | 대응 |
|------|------|------|
| TTS 실패 | GPU 메모리 부족 | 배치 크기 줄이기 |
| 이미지 생성 실패 | 프롬프트 문제 | 영어 프롬프트 사용 |
| FFmpeg 에러 | 코덱 호환 | 코덱 재인코딩 |
| 유튜브 업로드 실패 | API 할당량 | 재시도 로직 |

---

## 8. 테스트 계획

### 단위 테스트
- [ ] TTS 생성 테스트 (텍스트 → 오디오)
- [ ] 이미지 생성 테스트 (프롬프트 → 이미지)
- [ ] 영상 합성 테스트 (오디오+이미지 → 영상)

### 통합 테스트
- [ ] 전체 파이프라인 테스트 (대본 → 유튜브 영상)
- [ ] 10편 연속 생성 테스트

### 품질 테스트
- [ ] TTS 음질 청취 검사
- [ ] 이미지 품질 검사
- [ ] 자막 동기화 검사

---

*다음 문서: [03_ROADMAP_로드맵](03_ROADMAP_2026-02-03_AI할머니옛날이야기.md)*
